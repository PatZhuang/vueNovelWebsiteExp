<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- 引入样式 -->
  <link href="https://cdn.bootcss.com/element-ui/1.3.3/theme-default/index.css" rel="stylesheet">
  <style>
      body {
          margin: 0;
          font-family: 'Hiragino Sans GB';
      }
      a {
          text-decoration: none;
      }
  </style>
</head>
<body>
  <div id="app">
    <el-menu theme="dark" :default-active="activeIndex" class="el-menu-demo" mode="horizontal" @select="handleSelect">
        <el-menu-item index="1">处理中心</el-menu-item>
            <el-submenu index="2">
                <template slot="title">我的工作台</template>
                <el-menu-item index="2-1">选项1</el-menu-item>
                <el-menu-item index="2-2">选项2</el-menu-item>
                <el-menu-item index="2-3">选项3</el-menu-item>
            </el-submenu>
        <el-menu-item index="3"><a href="https://www.ele.me" target="_blank">订单管理</a></el-menu-item>
    </el-menu>
    <el-row type="flex" justify="center" style="margin-top: 30px">
        <el-col :span="8">
          <el-card>
            <div slot="header" style="text-align: center">
              <span style="line-height: 36px; font-weight: 500;">开通起点会员</span>
            </div>
            <el-form ref="form" :model="form" label-width="80px" style="text-align: left;">
                <el-form-item label="开通对象">
                  <el-input v-model="form.id" style="width: 300px;" disabled></el-input>
                </el-form-item>
                <el-form-item label="开通时长">
                  <el-input v-model="form.duration" style="width: 300px;" disabled></el-input>
                </el-form-item>
                <el-form-item label="交易金额">
                    &nbsp;
                    <span style="color: #e74c3c; font-size: 20px; font-weight: 600;">{{form.duration * 10}}</span>
                    <span>元</span>
                </el-form-item>
                <el-form-item>
                    <el-button 
                      type="primary" 
                      @click="onSubmit" 
                      ref="confirmBtn"
                      v-loading.fullscreen.lock="fullscreenLoading">
                      确认付款
                    </el-button>
                    <el-button type="plain" @click="onCancel">取消</el-button>
                </el-form-item>
            </el-form>
          </el-card>
        </el-col>
    </el-row>
  </div>
</body>
  <!-- 先引入 Vue -->
  <script src="https://cdn.bootcss.com/vue/2.3.3/vue.min.js"></script>
  <!-- 引入组件库 -->
  <script src="https://cdn.bootcss.com/element-ui/1.3.3/index.js"></script>
  <!--引入 axios -->
  <script src="https://cdn.bootcss.com/axios/0.16.1/axios.min.js"></script>
  <script>
    new Vue({
      el: '#app',
      data: function() {
        return { 
            activeIndex: '1',
            activeIndex2: '1',
            form: {
              id: '',
              vipExpiration: '',
              duration: '1',
              method: 'alipay'
            },
            fullscreenLoading : false
         }
      },
      methods: {
        handleSelect(key, keyPath) {
          console.log(key, keyPath);
        },
        onSubmit() {
          var that = this;
          this.fullscreenLoading = true;
          console.log(location.href);
          axios.post('/api/pay-vip', {
            url: location.href
          })
          .then(function (response) {
            var status = response.data.status;
            if (status == 'success') {
              setTimeout(function() {
                that.fullscreenLoading = false;
                that.$notify({
                  title: '付款成功',
                  message: '该页面将在2秒后关闭',
                  duration: 2000,
                  type: 'success',
                  onClose: () => self.close()
                });
              }, 2000);
            }
            console.log(response.data);
          })
          .catch(function (e) {
            console.log(e);
          })
        },
        onCancel() {
          var that = this;
          this.$confirm('是否取消付款？', '取消付款', {
            confirmButtonText: '取消',
            cancelButtonText: '不取消',
            callback: action => {
              if (action == 'confirm') {
                that.$notify({
                  title: '付款已取消',
                  message: '该页面将在2秒后关闭',
                  duration: 2000,
                  type: 'info',
                  onClose: () => self.close()
                }) 
              }
            }
          });
        }
      }
    })
  </script>
</html>